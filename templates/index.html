<!doctype html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒØ§Ø´ÙŠØ± - Ø³ÙˆØ¨Ø± Ù…Ø§Ø±ÙƒØª</title>
    <!-- Ø¥Ø¶Ø§ÙØ© Ù…ÙƒØªØ¨Ø© Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
      }

      header {
        background: white;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        margin-bottom: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .logo h1 {
        color: #667eea;
        font-size: 28px;
      }

      .user-info {
        text-align: left;
      }

      .user-info div {
        margin: 5px 0;
      }

      .user-name {
        font-weight: bold;
        color: #333;
        font-size: 18px;
      }

      .user-role {
        color: #667eea;
        font-size: 14px;
      }

      .logout-btn {
        padding: 8px 16px;
        background: #e74c3c;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        margin-top: 5px;
      }

      .main-content {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 20px;
      }

      .search-section {
        background: white;
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      }

      .search-box {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
      }

      input {
        padding: 12px;
        border: 2px solid #ddd;
        border-radius: 8px;
        font-size: 16px;
        flex: 1;
      }

      button {
        padding: 12px 25px;
        background: #667eea;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        transition: background 0.3s;
      }

      button:hover {
        background: #5568d3;
      }

      button.danger {
        background: #e74c3c;
        width: 100%;
        margin-top: 10px;
      }

      button.success {
        background: #27ae60;
        width: 100%;
        padding: 15px;
        font-size: 18px;
        margin-top: 20px;
      }

      button.warning {
        background: #f39c12;
      }

      button.secondary {
        background: #95a5a6;
      }

      button.info {
        background: #3498db;
      }

      .cart {
        background: white;
        border: 2px solid #667eea;
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      }

      .cart-item {
        display: flex;
        justify-content: space-between;
        padding: 10px 0;
        border-bottom: 1px solid #eee;
      }

      .cart-total {
        font-size: 28px;
        font-weight: bold;
        text-align: center;
        margin: 20px 0;
        color: #667eea;
      }

      .discount-section {
        margin: 15px 0;
        padding: 10px;
        background: #f9f9f9;
        border-radius: 8px;
      }

      .payment-methods {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        margin: 20px 0;
      }

      .product-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 10px;
        margin-top: 20px;
        max-height: 400px;
        overflow-y: auto;
      }

      .product-card {
        border: 1px solid #ddd;
        padding: 15px;
        border-radius: 10px;
        cursor: pointer;
        transition: transform 0.2s;
        text-align: center;
        background: #f9f9f9;
      }

      .product-card:hover {
        transform: scale(1.05);
        border-color: #667eea;
        background: #fff;
      }

      .product-name {
        font-weight: bold;
        margin-bottom: 5px;
        font-size: 14px;
      }

      .product-price {
        color: #e74c3c;
        font-size: 18px;
        font-weight: bold;
      }

      .product-quantity {
        color: #666;
        font-size: 12px;
        margin-top: 5px;
      }

      .message {
        padding: 12px;
        margin: 10px 0;
        border-radius: 8px;
        text-align: center;
        font-weight: bold;
      }

      .success-message {
        background: #d4edda;
        color: #155724;
      }

      .error-message {
        background: #f8d7da;
        color: #721c24;
      }

      .info-message {
        background: #d1ecf1;
        color: #0c5460;
      }

      .nav-buttons {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
      }

      .nav-btn {
        flex: 1;
        padding: 12px;
        font-size: 16px;
      }

      .invoice-print {
        background: white;
        padding: 30px;
        border-radius: 10px;
        margin-top: 20px;
        display: none;
      }

      .print-header {
        text-align: center;
        margin-bottom: 20px;
        border-bottom: 2px solid #667eea;
        padding-bottom: 10px;
      }

      .print-items {
        margin: 20px 0;
      }

      .print-item {
        display: flex;
        justify-content: space-between;
        padding: 5px 0;
        border-bottom: 1px dashed #ddd;
      }

      .print-total {
        text-align: center;
        font-size: 24px;
        font-weight: bold;
        margin: 20px 0;
        color: #667eea;
      }

      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        justify-content: center;
        align-items: center;
      }

      .modal-content {
        background: white;
        padding: 30px;
        border-radius: 10px;
        width: 90%;
        max-width: 500px;
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid #667eea;
      }

      .close-modal {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: #999;
      }

      .form-group {
        margin-bottom: 15px;
      }

      .form-group label {
        display: block;
        margin-bottom: 5px;
        color: #555;
        font-weight: 500;
      }

      .form-group input,
      .form-group select {
        width: 100%;
        padding: 10px;
        border: 2px solid #ddd;
        border-radius: 5px;
        font-size: 14px;
      }

      /* Ù†Ø§ÙØ°Ø© Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ */
      #barcodeScannerModal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        z-index: 2000;
        justify-content: center;
        align-items: center;
        flex-direction: column;
      }

      #barcodeScannerContainer {
        width: 90%;
        max-width: 640px;
        position: relative;
      }

      #barcodeScannerVideo {
        width: 100%;
        border: 3px solid #667eea;
        border-radius: 10px;
        background: black;
      }

      .scanner-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border: 3px solid rgba(102, 126, 234, 0.8);
        box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.5);
        pointer-events: none;
      }

      .scanner-line {
        position: absolute;
        top: 50%;
        left: 0;
        width: 100%;
        height: 3px;
        background: rgba(102, 126, 234, 0.8);
        animation: scan 2s infinite linear;
      }

      @keyframes scan {
        0% {
          top: 0;
        }
        100% {
          top: 100%;
        }
      }

      .scanner-controls {
        margin-top: 20px;
        display: flex;
        gap: 15px;
      }

      .scanner-btn {
        padding: 12px 30px;
        font-size: 16px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s;
      }

      .scanner-btn-close {
        background: #e74c3c;
        color: white;
      }

      .scanner-btn-close:hover {
        background: #c0392b;
      }

      .scanner-status {
        color: white;
        font-size: 16px;
        margin-top: 15px;
        text-align: center;
      }

      @media print {
        body * {
          visibility: hidden;
          margin: 0;
          padding: 0;
        }

        .invoice-print,
        .invoice-print * {
          visibility: visible;
        }

        .invoice-print {
          position: absolute;
          left: 0;
          top: 0;
          width: 100%;
          max-width: 100%;
          box-shadow: none;
          border: none;
          padding: 20px;
          font-size: 14px;
        }

        .print-header {
          text-align: center;
          margin-bottom: 20px;
          border-bottom: 2px solid #000;
          padding-bottom: 10px;
        }

        .print-item {
          display: flex;
          justify-content: space-between;
          padding: 8px 0;
          border-bottom: 1px dashed #ddd;
          font-size: 16px;
        }

        .print-total {
          text-align: center;
          font-size: 24px;
          font-weight: bold;
          margin: 30px 0;
          color: #000;
        }

        button,
        .nav-buttons,
        .search-box,
        .cart,
        header {
          display: none !important;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <div class="logo">
          <h1>ğŸ›’ Ù†Ø¸Ø§Ù… Ø§Ù„ÙƒØ§Ø´ÙŠØ± - Ø³ÙˆØ¨Ø± Ù…Ø§Ø±ÙƒØª</h1>
        </div>
        <div class="user-info">
          <div class="user-name" id="userName">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
          <div class="user-role" id="userRole"></div>
          <button class="logout-btn" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
        </div>
      </header>

      <div class="nav-buttons">
        <button
          class="nav-btn success"
          onclick="location.href = '/dashboard'"
          title="Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…"
        >
          <span style="font-size: 24px">ğŸ“Š</span><br />Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
        </button>
        <button
          class="nav-btn secondary"
          onclick="location.href = '/warehouse'"
          title="Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²Ù†"
        >
          <span style="font-size: 24px">ğŸ“¦</span><br />Ø§Ù„Ù…Ø®Ø²Ù†
        </button>
        <button
          class="nav-btn warning"
          onclick="location.href = '/reports'"
          title="ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ÙˆØ§Ù„Ù…Ø®Ø²ÙˆÙ†"
        >
          <span style="font-size: 24px">ğŸ“ˆ</span><br />ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
        </button>
        <button
          class="nav-btn info"
          onclick="location.href = '/accounting'"
          title="Ø´Ø¬Ø±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª"
        >
          <span style="font-size: 24px">ğŸ§¾</span><br />Ø´Ø¬Ø±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª
        </button>
        <button
          class="nav-btn primary"
          onclick="location.href = '/financial_reports'"
          title="Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠØ©"
        >
          <span style="font-size: 24px">ğŸ’°</span><br />ØªÙ‚Ø§Ø±ÙŠØ± Ù…Ø§Ù„ÙŠØ©
        </button>
        <button
          class="nav-btn danger"
          onclick="location.href = '/suppliers'"
          title="Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†"
        >
          <span style="font-size: 24px">ğŸšš</span><br />Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†
        </button>
      </div>

      <div class="main-content">
        <div>
          <div class="search-section">
            <h2>ğŸ” Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬</h2>
            <div class="search-box">
              <input
                type="text"
                id="searchInput"
                placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø£Ùˆ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬..."
                autofocus
              />
              <button onclick="searchProduct()">Ø¨Ø­Ø«</button>
              <button class="info" onclick="openBarcodeScanner()">
                ğŸ“· Ù…Ø³Ø­
              </button>
            </div>

            <div id="message"></div>

            <div class="discount-section">
              <label
                style="display: block; margin-bottom: 5px; font-weight: bold"
              >
                ğŸ Ø§Ù„Ø®ØµÙ… (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):
              </label>
              <input
                type="number"
                id="discountInput"
                placeholder="0.00"
                step="0.01"
                oninput="updateTotal()"
                style="width: 100%; padding: 8px"
              />
            </div>

            <h3 style="margin-top: 20px">ğŸ“¦ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©</h3>
            <div class="product-grid" id="productsGrid">
              <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
            </div>
          </div>
        </div>

        <!-- Ù‚Ø³Ù… Ø§Ù„Ø³Ù„Ø© ÙˆØ§Ù„ÙØ§ØªÙˆØ±Ø© -->
        <div>
          <div class="cart">
            <h2>ğŸ›’ Ø§Ù„Ø³Ù„Ø©</h2>
            <div id="cartItems">
              <p style="text-align: center; color: #999">Ø³Ù„Ø© ÙØ§Ø±ØºØ©</p>
            </div>

            <div class="cart-total">
              Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="total">0.00</span> Ø¬Ù†ÙŠÙ‡
            </div>

            <h3>ğŸ’³ Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</h3>
            <div class="payment-methods">
              <button onclick="setPaymentMethod('ÙƒØ§Ø´')">ÙƒØ§Ø´</button>
              <button onclick="setPaymentMethod('ÙÙŠØ²Ø§')">ÙÙŠØ²Ø§</button>
              <button onclick="setPaymentMethod('ØªØ­ÙˆÙŠÙ„')">ØªØ­ÙˆÙŠÙ„</button>
              <button onclick="setPaymentMethod('Ù…Ø­ÙØ¸Ø©')">Ù…Ø­ÙØ¸Ø©</button>
            </div>

            <button class="success" onclick="checkout()">Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø´Ø±Ø§Ø¡</button>
            <button class="danger" onclick="clearCart()">Ù…Ø³Ø­ Ø§Ù„Ø³Ù„Ø©</button>
          </div>
        </div>
      </div>

      <!-- ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© -->
      <!-- ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© -->
      <div class="invoice-print" id="invoicePrint" style="display: none">
        <div class="print-header">
          <h2>ğŸ›’ Ø³ÙˆØ¨Ø± Ù…Ø§Ø±ÙƒØª</h2>
          <p>ÙØ§ØªÙˆØ±Ø© Ø¶Ø±ÙŠØ¨ÙŠØ©</p>
          <div
            style="
              display: flex;
              justify-content: space-between;
              margin-top: 10px;
            "
          >
            <div>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©: <strong id="printInvoiceNumber"></strong></div>
            <div>Ø§Ù„ØªØ§Ø±ÙŠØ®: <strong id="printDate"></strong></div>
          </div>
          <div style="margin-top: 5px">
            Ø§Ù„ÙƒØ§Ø´ÙŠØ±: <strong id="printCashier"></strong>
          </div>
        </div>

        <div class="print-items" id="printItems">
          <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
        </div>

        <div class="print-total">
          Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: <span id="printTotal"></span> Ø¬Ù†ÙŠÙ‡
        </div>

        <div
          style="
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #000;
          "
        >
          <p>Ø´ÙƒØ±Ø§Ù‹ Ù„Ø²ÙŠØ§Ø±ØªÙƒÙ…! ğŸ‘‹</p>
          <p style="font-size: 12px; color: #666">
            Ù‡Ø§ØªÙ: 01234567890 | Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: Ø´Ø§Ø±Ø¹ Ø§Ù„Ø³ÙˆØ¨Ø± Ù…Ø§Ø±ÙƒØª
          </p>
        </div>
      </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø¨Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ -->
    <div id="barcodeScannerModal">
      <div id="barcodeScannerContainer">
        <video id="barcodeScannerVideo" playsinline></video>
        <div class="scanner-overlay">
          <div class="scanner-line"></div>
        </div>
      </div>
      <div class="scanner-status" id="scannerStatus">
        Ø¬Ø§Ø±ÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§...
      </div>
      <div class="scanner-controls">
        <button
          class="scanner-btn scanner-btn-close"
          onclick="closeBarcodeScanner()"
        >
          Ø¥ØºÙ„Ø§Ù‚
        </button>
      </div>
    </div>

    <!-- Modal Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ù…Ù† Ø§Ù„ÙƒØ§Ø´ÙŠØ± -->
    <div class="modal" id="addProductPosModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h2>
          <button
            class="close-modal"
            onclick="closeModal('addProductPosModal')"
          >
            &times;
          </button>
        </div>
        <div id="posModalMessage"></div>
        <form id="addProductPosForm">
          <div class="form-group">
            <label>Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ *</label>
            <input type="text" id="posProductBarcode" required />
          </div>

          <div class="form-group">
            <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬ *</label>
            <input type="text" id="posProductName" required />
          </div>

          <div class="form-group">
            <label>Ø§Ù„Ø³Ø¹Ø± *</label>
            <input type="number" id="posProductPrice" step="0.01" required />
          </div>

          <div class="form-group">
            <label>Ø§Ù„ÙƒÙ…ÙŠØ© *</label>
            <input
              type="number"
              id="posProductQuantity"
              required
              min="1"
              value="1"
            />
          </div>

          <button
            type="submit"
            class="btn btn-primary"
            style="width: 100%; padding: 12px; font-size: 16px"
          >
            Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬
          </button>
        </form>
      </div>
    </div>

    <script>
      let cart = [];
      let paymentMethod = "ÙƒØ§Ø´";
      let products = [];
      let discount = 0;
      let barcodeScannerActive = false;
      let scannerStream = null;

      // ØªØ­Ù…ÙŠÙ„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
      function loadUserInfo() {
        fetch("/get_session_info")
          .then((response) => response.json())
          .then((data) => {
            if (data.logged_in) {
              document.getElementById("userName").textContent = data.full_name;
              document.getElementById("userRole").textContent =
                `Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©: ${data.role}`;
            } else {
              window.location.href = "/login";
            }
          });
      }

      // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
      function logout() {
        fetch("/logout").then(() => {
          window.location.href = "/login";
        });
      }

      // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
      window.onload = function () {
        loadUserInfo();
        loadProducts();
      };

      // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±
      function loadProducts() {
        fetch("/api/products")
          .then((response) => response.json())
          .then((data) => {
            products = data.products.filter((p) => p.quantity > 0);
            displayProducts();
          });
      }

      // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ©
      function displayProducts() {
        const grid = document.getElementById("productsGrid");
        grid.innerHTML = "";

        products.slice(0, 16).forEach((product) => {
          const card = document.createElement("div");
          card.className = "product-card";
          card.onclick = () => addToCart(product);
          card.innerHTML = `
                    <div class="product-name">${product.name}</div>
                    <div class="product-price">${product.price.toFixed(2)} Ø¬Ù†ÙŠÙ‡</div>
                    <div class="product-quantity">Ø§Ù„Ù…ØªØ§Ø­: ${product.quantity}</div>
                `;
          grid.appendChild(card);
        });
      }

      // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬
      function searchProduct() {
        const searchTerm = document.getElementById("searchInput").value.trim();

        if (!searchTerm) {
          showMessage("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø£Ùˆ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬", "error");
          return;
        }

        fetch("/api/search_product", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ search: searchTerm }),
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              addToCart(data.product);
              document.getElementById("searchInput").value = "";
            } else {
              showMessage(data.message, "error");
            }
          });
      }

      // Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ù„Ù„Ø³Ù„Ø©
      function addToCart(product) {
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒÙ…ÙŠØ©
        if (product.quantity <= 0) {
          showMessage("Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ØªÙˆÙØ± ÙÙŠ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†", "error");
          return;
        }

        // Ø§Ù„Ø¨Ø­Ø« Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù…Ù†ØªØ¬ Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„
        const existing = cart.find((item) => item.id === product.id);

        if (existing) {
          existing.quantity += 1;
        } else {
          cart.push({
            id: product.id,
            name: product.name,
            price: product.price,
            quantity: 1,
          });
        }

        updateCartDisplay();
        showMessage(`${product.name} ØªÙ…Øª Ø¥Ø¶Ø§ÙØªÙ‡ Ù„Ù„Ø³Ù„Ø©`, "success");
      }

      // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ø³Ù„Ø©
      function updateCartDisplay() {
        const cartItems = document.getElementById("cartItems");
        const totalElement = document.getElementById("total");

        if (cart.length === 0) {
          cartItems.innerHTML =
            '<p style="text-align: center; color: #999;">Ø³Ù„Ø© ÙØ§Ø±ØºØ©</p>';
          totalElement.textContent = "0.00";
          document.getElementById("discountInput").value = "0.00";
          discount = 0;
          return;
        }

        let html = "";
        let subtotal = 0;

        cart.forEach((item, index) => {
          const itemTotal = item.price * item.quantity;
          subtotal += itemTotal;

          html += `
                    <div class="cart-item">
                        <div>
                            <strong>${item.name}</strong><br>
                            ${item.price.toFixed(2)} Ã— ${item.quantity}
                        </div>
                        <div>
                            <span style="color: #e74c3c; font-weight: bold;">${itemTotal.toFixed(2)}</span>
                            <button onclick="removeItem(${index})" style="margin-left: 10px; padding: 5px 10px; background: #e74c3c; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px;">Ã—</button>
                        </div>
                    </div>
                `;
        });

        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø®ØµÙ…
        discount =
          parseFloat(document.getElementById("discountInput").value) || 0;
        const finalTotal = subtotal - discount;

        cartItems.innerHTML = html;
        totalElement.textContent = finalTotal.toFixed(2);
      }

      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ø®ØµÙ…
      function updateTotal() {
        updateCartDisplay();
      }

      // Ø­Ø°Ù Ø¹Ù†ØµØ± Ù…Ù† Ø§Ù„Ø³Ù„Ø©
      function removeItem(index) {
        cart.splice(index, 1);
        updateCartDisplay();
      }

      // ØªØ¹ÙŠÙŠÙ† Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹
      function setPaymentMethod(method) {
        paymentMethod = method;
        showMessage(`Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹: ${method}`, "success");
      }

      // Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø´Ø±Ø§Ø¡
      // Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø´Ø±Ø§Ø¡ - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…ØµØ­Ø­Ø©
      function checkout() {
        if (cart.length === 0) {
          showMessage("Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©!", "error");
          return;
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø®ØµÙ…
        discount =
          parseFloat(document.getElementById("discountInput").value) || 0;

        // ØªØ­Ø¶ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø¥Ø±Ø³Ø§Ù„
        const invoiceData = {
          items: cart.map((item) => ({
            id: item.id,
            name: item.name,
            price: item.price,
            quantity: item.quantity,
          })),
          payment_method: paymentMethod,
          discount: discount,
          total: calculateTotal(),
        };

        console.log("Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ù…Ø±Ø³Ù„Ø©:", invoiceData);

        fetch("/api/create_invoice", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(invoiceData),
        })
          .then((response) => {
            if (!response.ok) {
              throw new Error("Network response was not ok");
            }
            return response.json();
          })
          .then((data) => {
            console.log("Ø§Ù„Ø±Ø¯ Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±:", data);

            if (data.success) {
              // Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù…Ø­Ù„ÙŠØ§Ù‹ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø³ÙŠØ±ÙØ± Ù„Ø§ ÙŠØ±Ø¬Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§Ù…Ù„Ø©
              const invoiceDataForPrint = {
                invoice_number: data.invoice_number || generateInvoiceNumber(),
                date: new Date(),
                cashier: document.getElementById("userName").textContent,
                items: cart,
                total: calculateTotal() - discount,
                payment_method: paymentMethod,
                discount: discount,
              };

              // Ø¹Ø±Ø¶ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©
              printInvoice(invoiceDataForPrint);

              showMessage(
                `âœ… ØªÙ… Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø´Ø±Ø§Ø¡ Ø¨Ù†Ø¬Ø§Ø­!<br>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©: ${invoiceDataForPrint.invoice_number}<br>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${invoiceDataForPrint.total.toFixed(2)} Ø¬Ù†ÙŠÙ‡`,
                "success",
              );

              cart = [];
              updateCartDisplay();
              loadProducts(); // ØªØ­Ø¯ÙŠØ« ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
            } else {
              showMessage(
                "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙØ§ØªÙˆØ±Ø©: " + (data.message || ""),
                "error",
              );
            }
          })
          .catch((error) => {
            console.error("Error:", error);
            showMessage("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±", "error");

            // ÙÙŠ Ø­Ø§Ù„Ø© ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±ØŒ Ù†Ù†Ø´Ø¦ ÙØ§ØªÙˆØ±Ø© Ù…Ø­Ù„ÙŠØ©
            const localInvoiceData = {
              invoice_number: generateInvoiceNumber(),
              date: new Date(),
              cashier: document.getElementById("userName").textContent,
              items: cart,
              total: calculateTotal() - discount,
              payment_method: paymentMethod,
              discount: discount,
            };

            printInvoice(localInvoiceData);
            showMessage(
              "âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ÙØ§ØªÙˆØ±Ø© Ù…Ø­Ù„ÙŠØ©ØŒ ÙˆÙ„ÙƒÙ† ÙŠØ±Ø¬Ù‰ Ù…Ø±Ø§Ø¬Ø¹Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±",
              "warning",
            );
          });
      }

      // Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
      function calculateTotal() {
        let total = 0;
        cart.forEach((item) => {
          total += item.price * item.quantity;
        });
        return total;
      }

      // ØªÙˆÙ„ÙŠØ¯ Ø±Ù‚Ù… ÙØ§ØªÙˆØ±Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠ
      function generateInvoiceNumber() {
        return "INV-" + Date.now() + "-" + Math.floor(Math.random() * 1000);
      }
      // Ø¯Ø§Ù„Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
      function testPrint() {
        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ø®ØªØ¨Ø§Ø±ÙŠØ©
        const testData = {
          invoice_number: "TEST-001",
          date: new Date(),
          cashier: "ÙƒØ§Ø´ÙŠØ± Ø§Ø®ØªØ¨Ø§Ø±",
          items: [
            { name: "Ù…Ù†ØªØ¬ Ø§Ø®ØªØ¨Ø§Ø± 1", price: 10, quantity: 2 },
            { name: "Ù…Ù†ØªØ¬ Ø§Ø®ØªØ¨Ø§Ø± 2", price: 20, quantity: 1 },
          ],
          total: 40,
          payment_method: "ÙƒØ§Ø´",
          discount: 0,
        };

        printInvoice(testData);
      }

      // Ø²Ø± Ø§Ø®ØªØ¨Ø§Ø± ÙÙŠ Ø§Ù„ØµÙØ­Ø© (ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØªÙ‡ Ù…Ø¤Ù‚ØªØ§Ù‹)
      function addTestButton() {
        const header = document.querySelector("header");
        const testBtn = document.createElement("button");
        testBtn.textContent = "ğŸ”§ Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©";
        testBtn.style.background = "#9b59b6";
        testBtn.style.marginLeft = "10px";
        testBtn.onclick = testPrint;
        document.querySelector(".user-info").appendChild(testBtn);
      }

      // Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
      window.onload = function () {
        loadUserInfo();
        loadProducts();
        addTestButton(); // Ø¥Ø¶Ø§ÙØ© Ø²Ø± Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±
      };
      // Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©
      // Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø© - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…ØµØ­Ø­Ø©
      function printInvoice(data) {
        const printDiv = document.getElementById("invoicePrint");
        const printItems = document.getElementById("printItems");

        // Ù…Ù„Ø¡ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙØ§ØªÙˆØ±Ø©
        document.getElementById("printInvoiceNumber").textContent =
          data.invoice_number;
        document.getElementById("printDate").textContent =
          new Date().toLocaleDateString("ar-EG");
        document.getElementById("printCashier").textContent =
          document.getElementById("userName").textContent;

        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ
        let subtotal = 0;
        cart.forEach((item) => {
          subtotal += item.price * item.quantity;
        });
        const finalTotal = subtotal - discount;

        document.getElementById("printTotal").textContent =
          finalTotal.toFixed(2);

        // Ù…Ù„Ø¡ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
        printItems.innerHTML = "";
        cart.forEach((item) => {
          const itemDiv = document.createElement("div");
          itemDiv.className = "print-item";
          itemDiv.innerHTML = `
            <span>${item.name} (${item.quantity})</span>
            <span>${(item.price * item.quantity).toFixed(2)}</span>
        `;
          printItems.appendChild(itemDiv);
        });

        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø®ØµÙ… Ø¥Ø°Ø§ ÙˆØ¬Ø¯
        if (discount > 0) {
          const discountDiv = document.createElement("div");
          discountDiv.className = "print-item";
          discountDiv.innerHTML = `
            <span>Ø§Ù„Ø®ØµÙ…</span>
            <span style="color: #e74c3c;">-${discount.toFixed(2)}</span>
        `;
          printItems.appendChild(discountDiv);
        }

        // Ø¥Ø¶Ø§ÙØ© Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹
        const paymentDiv = document.createElement("div");
        paymentDiv.className = "print-item";
        paymentDiv.innerHTML = `
        <span>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</span>
        <span>${paymentMethod}</span>
    `;
        printItems.appendChild(paymentDiv);

        // Ø¥Ø¸Ù‡Ø§Ø± ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
        printDiv.style.display = "block";

        // Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ø«Ù… Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
        setTimeout(() => {
          window.print();

          // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©
          setTimeout(() => {
            printDiv.style.display = "none";
          }, 500);
        }, 500);
      }

      // Ù…Ø³Ø­ Ø§Ù„Ø³Ù„Ø©
      function clearCart() {
        if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø§Ù„Ø³Ù„Ø©ØŸ")) {
          cart = [];
          updateCartDisplay();
          showMessage("ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø³Ù„Ø©", "success");
        }
      }

      // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø©
      function showMessage(text, type) {
        const messageDiv = document.getElementById("message");
        messageDiv.className = `message ${type}-message`;
        messageDiv.innerHTML = text;

        setTimeout(() => {
          messageDiv.innerHTML = "";
        }, 3000);
      }

      // Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø¥Ù†ØªØ±
      document
        .getElementById("searchInput")
        .addEventListener("keypress", function (e) {
          if (e.key === "Enter") {
            searchProduct();
          }
        });

      // ÙØªØ­ Ù†Ø§ÙØ°Ø© Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯ Ø¨Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
      function openBarcodeScanner() {
        document.getElementById("barcodeScannerModal").style.display = "flex";
        document.getElementById("scannerStatus").textContent =
          "Ø¬Ø§Ø±ÙŠ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§...";

        // Ø·Ù„Ø¨ Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„ÙƒØ§Ù…ÙŠØ±Ø§
        navigator.mediaDevices
          .getUserMedia({
            video: {
              facingMode: "environment", // Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ø§Ù„Ø®Ù„ÙÙŠØ© Ù„Ù„Ø¬ÙˆØ§Ù„
            },
          })
          .then((stream) => {
            scannerStream = stream;
            const video = document.getElementById("barcodeScannerVideo");
            video.srcObject = stream;
            video.play();

            document.getElementById("scannerStatus").textContent =
              " ÙˆØ¬Ù‡ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ Ù†Ø­Ùˆ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯...";

            // Ø¨Ø¯Ø¡ Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯
            barcodeScannerActive = true;
            startBarcodeScanner();
          })
          .catch((err) => {
            console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§:", err);
            document.getElementById("scannerStatus").textContent =
              "Ø®Ø·Ø£: " + err.message;
            setTimeout(closeBarcodeScanner, 3000);
          });
      }

      // Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯
      function closeBarcodeScanner() {
        barcodeScannerActive = false;

        // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
        if (scannerStream) {
          scannerStream.getTracks().forEach((track) => track.stop());
          scannerStream = null;
        }

        // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
        const video = document.getElementById("barcodeScannerVideo");
        video.srcObject = null;

        document.getElementById("barcodeScannerModal").style.display = "none";
      }

      // Ø¨Ø¯Ø¡ Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯
      function startBarcodeScanner() {
        if (!barcodeScannerActive) return;

        const video = document.getElementById("barcodeScannerVideo");

        // Ø§Ù„ØªÙ‚Ø§Ø· ØµÙˆØ±Ø© Ù…Ù† Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
        const canvas = document.createElement("canvas");
        const context = canvas.getContext("2d");
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        context.drawImage(video, 0, 0, canvas.width, canvas.height);

        // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        const imageData = context.getImageData(
          0,
          0,
          canvas.width,
          canvas.height,
        );

        // Ø§Ø³ØªØ®Ø¯Ø§Ù… QuaggaJS Ù„Ù…Ø³Ø­ Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯
        Quagga.decodeSingle(
          {
            decoder: {
              readers: [
                "ean_13_reader",
                "ean_8_reader",
                "upc_reader",
                "code_128_reader",
              ],
            },
            locate: true,
            src: canvas.toDataURL("image/png"),
          },
          function (result) {
            if (result && result.codeResult) {
              const barcode = result.codeResult.code;
              document.getElementById("scannerStatus").textContent =
                "ØªÙ… Ø§ÙƒØªØ´Ø§Ù: " + barcode;

              // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯
              searchProductByBarcode(barcode);

              // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ù†Ø¬Ø§Ø­
              setTimeout(closeBarcodeScanner, 1000);
            } else {
              // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©
              setTimeout(startBarcodeScanner, 500);
            }
          },
        );
      }

      // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬ Ø¨Ø§Ù„Ø¨Ø§Ø±ÙƒÙˆØ¯
      function searchProductByBarcode(barcode) {
        fetch("/api/search_product", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ search: barcode }),
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              addToCart(data.product);
              showMessage(
                `âœ… ${data.product.name} ØªÙ…Øª Ø¥Ø¶Ø§ÙØªÙ‡ Ù„Ù„Ø³Ù„Ø©`,
                "success",
              );
            } else {
              showMessage("Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯", "error");

              // Ø³Ø¤Ø§Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¥Ø°Ø§ ÙƒØ§Ù† ÙŠØ±ÙŠØ¯ Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯
              if (confirm("Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¶Ø§ÙØªÙ‡ØŸ")) {
                openAddProductFromPos(barcode);
              }
            }
          });
      }

      // ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ù…Ù† Ø§Ù„ÙƒØ§Ø´ÙŠØ±
      function openAddProductFromPos(barcode = "") {
        document.getElementById("addProductPosModal").style.display = "flex";
        document.getElementById("addProductPosForm").reset();
        document.getElementById("posProductBarcode").value = barcode;
        document.getElementById("posModalMessage").innerHTML = "";
      }

      // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø©
      function closeModal(modalId) {
        document.getElementById(modalId).style.display = "none";
      }

      // Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ù…Ù† Ø§Ù„ÙƒØ§Ø´ÙŠØ±
      document
        .getElementById("addProductPosForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const productData = {
            barcode: document.getElementById("posProductBarcode").value,
            name: document.getElementById("posProductName").value,
            price: document.getElementById("posProductPrice").value,
            cost_price: 0,
            quantity: document.getElementById("posProductQuantity").value,
            min_stock: 5,
            category: "Ø£Ø®Ø±Ù‰",
            supplier: "",
          };

          const messageDiv = document.getElementById("posModalMessage");

          fetch("/api/products", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(productData),
          })
            .then((response) => response.json())
            .then((data) => {
              if (data.success) {
                messageDiv.className = "message success";
                messageDiv.textContent = data.message;

                // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ù„Ø³Ù„Ø©
                setTimeout(() => {
                  closeModal("addProductPosModal");
                  loadProducts();

                  // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ù†ØªØ¬ Ø§Ù„Ù…Ø¶Ø§Ù ÙˆØ¥Ø¶Ø§ÙØªÙ‡ Ù„Ù„Ø³Ù„Ø©
                  const newProduct = products.find(
                    (p) => p.barcode === productData.barcode,
                  );
                  if (newProduct) {
                    addToCart(newProduct);
                  }
                }, 1000);
              } else {
                messageDiv.className = "message error";
                messageDiv.textContent = data.message;
              }
            });
        });

      // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø®Ø§Ø±Ø¬Ù‡Ø§
      window.onclick = function (event) {
        const modal = document.getElementById("addProductPosModal");
        const scannerModal = document.getElementById("barcodeScannerModal");

        if (event.target === modal) {
          closeModal("addProductPosModal");
        }

        if (event.target === scannerModal) {
          closeBarcodeScanner();
        }
      };
    </script>
  </body>
</html>
