<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ø³ÙˆØ¨Ø± Ù…Ø§Ø±ÙƒØª</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: #f0f2f5;
            padding: 20px;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo h1 {
            font-size: 32px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo h1 span {
            font-size: 48px;
        }
        
        .user-info {
            text-align: left;
            background: rgba(255,255,255,0.15);
            padding: 15px 25px;
            border-radius: 50px;
        }
        
        .user-name {
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 5px;
        }
        
        .user-role {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .logout-btn {
            padding: 8px 20px;
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 30px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 8px;
            transition: all 0.3s;
        }
        
        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            font-weight: bold;
        }
        
        .icon-sales { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .icon-growth { background: linear-gradient(135deg, #27ae60 0%, #229954 100%); color: white; }
        .icon-products { background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); color: white; }
        .icon-lowstock { background: linear-gradient(135deg, #f39c12 0%, #d35400 100%); color: white; }
        .icon-outofstock { background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); color: white; }
        .icon-suppliers { background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%); color: white; }
        .icon-customers { background: linear-gradient(135deg, #1abc9c 0%, #16a085 100%); color: white; }
        .icon-revenue { background: linear-gradient(135deg, #e67e22 0%, #d35400 100%); color: white; }
        
        .stat-value {
            font-size: 36px;
            font-weight: bold;
            margin: 10px 0;
            color: #2c3e50;
        }
        
        .stat-label {
            font-size: 16px;
            color: #7f8c8d;
            margin-bottom: 8px;
        }
        
        .stat-footer {
            display: flex;
            align-items: center;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed #eee;
        }
        
        .growth-positive {
            color: #27ae60;
            font-weight: bold;
        }
        
        .growth-negative {
            color: #e74c3c;
            font-weight: bold;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .chart-container, .table-container {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            margin-bottom: 25px;
        }
        
        .section-title {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title span {
            color: #667eea;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        table th {
            background: #f8f9fa;
            padding: 15px;
            text-align: right;
            font-weight: bold;
            color: #555;
            border-bottom: 2px solid #e9ecef;
        }
        
        table td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
            color: #495057;
        }
        
        table tr:hover {
            background: #f8f9ff;
        }
        
        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }
        
        .status-sales {
            background: #e3f2fd;
            color: #1976d2;
        }
        
        .status-stock-add {
            background: #e8f5e9;
            color: #2e7d32;
        }
        
        .status-stock-remove {
            background: #ffebee;
            color: #c62828;
        }
        
        .payment-cash {
            background: #e3f2fd;
            color: #1565c0;
            padding: 3px 10px;
            border-radius: 15px;
            font-weight: bold;
        }
        
        .payment-card {
            background: #e8f5e9;
            color: #2e7d32;
            padding: 3px 10px;
            border-radius: 15px;
            font-weight: bold;
        }
        
        .top-products-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .product-item {
            display: flex;
            justify-content: space-between;
            padding: 15px;
            background: #f8f9ff;
            border-radius: 12px;
            border-left: 4px solid #667eea;
            transition: all 0.3s;
        }
        
        .product-item:hover {
            background: #edf2ff;
            transform: translateX(5px);
        }
        
        .product-info h4 {
            font-size: 18px;
            margin-bottom: 5px;
            color: #2c3e50;
        }
        
        .product-info p {
            color: #7f8c8d;
            font-size: 14px;
        }
        
        .product-stats {
            text-align: left;
        }
        
        .product-quantity {
            font-size: 20px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 3px;
        }
        
        .product-sales {
            font-size: 16px;
            color: #27ae60;
            font-weight: bold;
        }
        
        .nav-buttons {
            display: flex;
            gap: 12px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }
        
        .nav-btn {
            flex: 1;
            min-width: 120px;
            padding: 15px 10px;
            background: white;
            color: #667eea;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 15px;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.08);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .nav-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.12);
            background: #667eea;
            color: white;
        }
        
        .nav-btn.success { background: #e3f2fd; color: #1976d2; }
        .nav-btn.secondary { background: #e8f5e9; color: #2e7d32; }
        .nav-btn.warning { background: #fff8e1; color: #5d4037; }
        .nav-btn.info { background: #e3f2fd; color: #0288d1; }
        .nav-btn.primary { background: #f3e5f5; color: #4a148c; }
        .nav-btn.danger { background: #ffebee; color: #c62828; }
        
        .nav-btn.success:hover { background: #1976d2; color: white; }
        .nav-btn.secondary:hover { background: #2e7d32; color: white; }
        .nav-btn.warning:hover { background: #5d4037; color: white; }
        .nav-btn.info:hover { background: #0288d1; color: white; }
        .nav-btn.primary:hover { background: #4a148c; color: white; }
        .nav-btn.danger:hover { background: #c62828; color: white; }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
            font-size: 18px;
            font-weight: bold;
        }
        
        .refresh-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .refresh-btn:hover {
            background: #5568d3;
            transform: scale(1.05);
        }
        
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .nav-buttons {
                flex-direction: row;
                flex-wrap: wrap;
            }
            
            .nav-btn {
                min-width: 100px;
                padding: 12px 8px;
                font-size: 13px;
            }
        }
        
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .nav-btn span {
                font-size: 20px !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <h1><span>ğŸ“Š</span> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>
            </div>
            <div class="user-info">
                <div class="user-name" id="userName">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
                <div class="user-role" id="userRole"></div>
                <button class="logout-btn" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
            </div>
        </header>
        
        <div class="nav-buttons">
            <button class="nav-btn secondary" onclick="location.href='/'">
                <span style="font-size: 28px;">ğŸ›’</span>
                <span>Ø§Ù„ÙƒØ§Ø´ÙŠØ±</span>
            </button>
            <button class="nav-btn secondary" onclick="location.href='/warehouse'">
                <span style="font-size: 28px;">ğŸ“¦</span>
                <span>Ø§Ù„Ù…Ø®Ø²Ù†</span>
            </button>
            <button class="nav-btn warning" onclick="location.href='/reports'">
                <span style="font-size: 28px;">ğŸ“ˆ</span>
                <span>ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</span>
            </button>
            <button class="nav-btn info" onclick="location.href='/accounting'">
                <span style="font-size: 28px;">ğŸ§¾</span>
                <span>Ø´Ø¬Ø±Ø© Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª</span>
            </button>
            <button class="nav-btn primary" onclick="location.href='/financial_reports'">
                <span style="font-size: 28px;">ğŸ’°</span>
                <span>ØªÙ‚Ø§Ø±ÙŠØ± Ù…Ø§Ù„ÙŠØ©</span>
            </button>
            <button class="nav-btn danger" onclick="location.href='/suppliers'">
                <span style="font-size: 28px;">ğŸšš</span>
                <span>Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†</span>
            </button>
        </div>
        
        <button class="refresh-btn" onclick="loadDashboardData()">
            <span>âŸ³</span> ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        </button>
        
        <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-label">Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…</div>
                    <div class="stat-icon icon-sales">ğŸ’°</div>
                </div>
                <div class="stat-value" id="todaySalesTotal">0.00</div>
                <div>Ø¹Ø¯Ø¯ Ø§Ù„ÙÙˆØ§ØªÙŠØ±: <strong id="todaySalesCount">0</strong></div>
                <div class="stat-footer">
                    <div>Ù…Ù‚Ø§Ø±Ù†Ø© Ø¨Ø§Ù„Ø£Ù…Ø³:</div>
                    <div id="growthPercentage" class="growth-positive">+0.00%</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</div>
                    <div class="stat-icon icon-revenue">ğŸ’µ</div>
                </div>
                <div class="stat-value" id="totalRevenue">0.00</div>
                <div>Ù…Ù†Ø° Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ù…Ù„</div>
            </div>
            
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-label">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</div>
                    <div class="stat-icon icon-products">ğŸ“¦</div>
                </div>
                <div class="stat-value" id="totalProducts">0</div>
                <div>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</div>
                <div class="stat-footer">
                    <div>Ù†Ø´Ø· Ø§Ù„Ø¢Ù†:</div>
                    <div id="activeProducts">0</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-label">Ù…Ù†Ø®ÙØ¶ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</div>
                    <div class="stat-icon icon-lowstock">âš ï¸</div>
                </div>
                <div class="stat-value" id="lowStockCount">0</div>
                <div>ØªØ­Øª Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰</div>
                <div class="stat-footer">
                    <div>ØªØ­ØªØ§Ø¬ ØªØ¯Ø®Ù„ ÙÙˆØ±ÙŠ</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-label">Ù†ÙØ° Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</div>
                    <div class="stat-icon icon-outofstock">âŒ</div>
                </div>
                <div class="stat-value" id="outOfStockCount">0</div>
                <div>Ù…Ù†ØªØ¬Ø§Øª Ù†ÙØ°Øª</div>
                <div class="stat-footer">
                    <div>ØªØ­ØªØ§Ø¬ Ø¥Ø¹Ø§Ø¯Ø© Ø·Ù„Ø¨</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-label">Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†</div>
                    <div class="stat-icon icon-suppliers">ğŸšš</div>
                </div>
                <div class="stat-value" id="totalSuppliers">0</div>
                <div>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†</div>
                <div class="stat-footer">
                    <div>Ù†Ø´Ø·ÙˆÙ†</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-label">Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</div>
                    <div class="stat-icon icon-customers">ğŸ‘¥</div>
                </div>
                <div class="stat-value" id="totalCustomers">0</div>
                <div>Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</div>
                <div class="stat-footer">
                    <div>Ø¹Ù…Ù„Ø§Ø¡ Ù†Ø´Ø·ÙˆÙ†</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-header">
                    <div class="stat-label">Ø§Ù„Ù†Ù…Ùˆ</div>
                    <div class="stat-icon icon-growth">ğŸ“ˆ</div>
                </div>
                <div class="stat-value" id="growthValue">0.00%</div>
                <div>Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ù…Ùˆ Ø§Ù„ÙŠÙˆÙ…ÙŠ</div>
                <div class="stat-footer">
                    <div>Ø§ØªØ¬Ø§Ù‡ ØªØµØ§Ø¹Ø¯ÙŠ</div>
                </div>
            </div>
        </div>
        
        <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
        <div class="main-content">
            <div>
                <!-- Ø¢Ø®Ø± Ø§Ù„ÙÙˆØ§ØªÙŠØ± -->
                <div class="chart-container">
                    <div class="section-title">ğŸ“‹ <span>Ø¢Ø®Ø± Ø§Ù„ÙÙˆØ§ØªÙŠØ±</span></div>
                    <div id="recentInvoices">
                        <div class="loading">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
                    </div>
                </div>
                
                <!-- Ø£ÙØ¶Ù„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ø¨ÙŠØ¹Ø§Ù‹ -->
                <div class="chart-container">
                    <div class="section-title">ğŸ† <span>Ø£ÙØ¶Ù„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ø¨ÙŠØ¹Ø§Ù‹ Ø§Ù„ÙŠÙˆÙ…</span></div>
                    <div id="topProducts">
                        <div class="loading">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
                    </div>
                </div>
            </div>
            
            <div>
                <!-- Ø­Ø±ÙƒØ§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø£Ø®ÙŠØ±Ø© -->
                <div class="table-container">
                    <div class="section-title">ğŸ”„ <span>Ø­Ø±ÙƒØ§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø£Ø®ÙŠØ±Ø©</span></div>
                    <div id="recentMovements">
                        <div class="loading">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
                    </div>
                </div>
                
                <!-- ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù‡Ø§Ù…Ø© -->
                <div class="table-container" style="background: linear-gradient(135deg, #fff8e1 0%, #ffecb3 100%); border: 2px solid #ffc107;">
                    <div class="section-title" style="color: #5d4037;">ğŸ”” <span>ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ù‡Ø§Ù…Ø©</span></div>
                    <div id="alertsContainer">
                        <div style="padding: 20px; text-align: center; color: #5d4037;">
                            <div style="font-size: 48px; margin-bottom: 15px;">ğŸ˜´</div>
                            <p style="font-size: 18px; font-weight: bold;">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</p>
                            <p style="margin-top: 10px; color: #795548;">ÙƒÙ„ Ø´ÙŠØ¡ ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ø·Ø¨ÙŠØ¹ÙŠ</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // ØªØ­Ù…ÙŠÙ„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        function loadUserInfo() {
            fetch('/get_session_info')
                .then(response => response.json())
                .then(data => {
                    if (data.logged_in) {
                        document.getElementById('userName').textContent = data.full_name;
                        document.getElementById('userRole').textContent = `Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©: ${data.role}`;
                    } else {
                        window.location.href = '/login';
                    }
                });
        }
        
        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
        function logout() {
            fetch('/logout')
                .then(() => {
                    window.location.href = '/login';
                });
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
        function loadDashboardData() {
            document.getElementById('recentInvoices').innerHTML = '<div class="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«...</div>';
            document.getElementById('recentMovements').innerHTML = '<div class="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«...</div>';
            document.getElementById('topProducts').innerHTML = '<div class="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«...</div>';
            
            fetch('/api/dashboard_data')
                .then(response => response.json())
                .then(data => {
                    updateDashboard(data);
                });
        }
        
        // ØªØ­Ø¯ÙŠØ« Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
        function updateDashboard(data) {
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            document.getElementById('todaySalesTotal').textContent = data.today_sales_total.toFixed(2);
            document.getElementById('todaySalesCount').textContent = data.today_sales_count;
            document.getElementById('totalRevenue').textContent = data.total_revenue.toFixed(2);
            document.getElementById('totalProducts').textContent = data.total_products;
            document.getElementById('lowStockCount').textContent = data.low_stock_count;
            document.getElementById('outOfStockCount').textContent = data.out_of_stock_count;
            document.getElementById('totalSuppliers').textContent = data.total_suppliers;
            document.getElementById('totalCustomers').textContent = data.total_customers;
            
            // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù†Ø´Ø·Ø©
            const activeProducts = data.total_products - data.out_of_stock_count;
            document.getElementById('activeProducts').textContent = activeProducts;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ù…Ùˆ
            const growthElem = document.getElementById('growthPercentage');
            const growthValueElem = document.getElementById('growthValue');
            
            if (data.growth_percentage >= 0) {
                growthElem.textContent = `+${data.growth_percentage}%`;
                growthElem.className = 'growth-positive';
                growthValueElem.textContent = `+${data.growth_percentage}%`;
                growthValueElem.className = 'stat-value';
                growthValueElem.style.color = '#27ae60';
            } else {
                growthElem.textContent = `${data.growth_percentage}%`;
                growthElem.className = 'growth-negative';
                growthValueElem.textContent = `${data.growth_percentage}%`;
                growthValueElem.className = 'stat-value';
                growthValueElem.style.color = '#e74c3c';
            }
            
            // Ø¹Ø±Ø¶ Ø¢Ø®Ø± Ø§Ù„ÙÙˆØ§ØªÙŠØ±
            const invoicesContainer = document.getElementById('recentInvoices');
            if (data.recent_invoices.length === 0) {
                invoicesContainer.innerHTML = '<p style="text-align: center; padding: 30px; color: #999;">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙˆØ§ØªÙŠØ± Ø­Ø¯ÙŠØ«Ø©</p>';
            } else {
                let invoicesHTML = `
                    <table>
                        <thead>
                            <tr>
                                <th>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</th>
                                <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                                <th>Ø§Ù„Ø¯ÙØ¹</th>
                                <th>Ø§Ù„ÙƒØ§Ø´ÙŠØ±</th>
                                <th>Ø§Ù„ÙˆÙ‚Øª</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                data.recent_invoices.forEach(invoice => {
                    const dateObj = new Date(invoice.date);
                    const timeStr = dateObj.toLocaleTimeString('ar-EG', {hour: '2-digit', minute:'2-digit'});
                    
                    invoicesHTML += `
                        <tr>
                            <td><strong>${invoice.invoice_number}</strong></td>
                            <td style="color: #e74c3c; font-weight: bold;">${invoice.final_total.toFixed(2)}</td>
                            <td>
                                ${invoice.payment_method === 'ÙƒØ§Ø´' ? 
                                    '<span class="payment-cash">ÙƒØ§Ø´</span>' : 
                                    '<span class="payment-card">Ø¨Ø·Ø§Ù‚Ø©</span>'}
                            </td>
                            <td>${invoice.cashier_name}</td>
                            <td>${timeStr}</td>
                        </tr>
                    `;
                });
                
                invoicesHTML += `</tbody></table>`;
                invoicesContainer.innerHTML = invoicesHTML;
            }
            
            // Ø¹Ø±Ø¶ Ø­Ø±ÙƒØ§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
            const movementsContainer = document.getElementById('recentMovements');
            if (data.recent_movements.length === 0) {
                movementsContainer.innerHTML = '<p style="text-align: center; padding: 30px; color: #999;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø±ÙƒØ§Øª Ø­Ø¯ÙŠØ«Ø©</p>';
            } else {
                let movementsHTML = `
                    <table>
                        <thead>
                            <tr>
                                <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
                                <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                                <th>Ø§Ù„Ù†ÙˆØ¹</th>
                                <th>Ø§Ù„Ù…ÙˆØ¸Ù</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                data.recent_movements.forEach(movement => {
                    const dateObj = new Date(movement.date);
                    const timeStr = dateObj.toLocaleTimeString('ar-EG', {hour: '2-digit', minute:'2-digit'});
                    const movementType = movement.movement_type === 'add' ? 'Ø¥Ø¶Ø§ÙØ©' : 'Ø¨ÙŠØ¹';
                    const statusClass = movement.movement_type === 'add' ? 'status-stock-add' : 'status-stock-remove';
                    
                    movementsHTML += `
                        <tr>
                            <td>${movement.product_name}</td>
                            <td style="font-weight: bold; color: ${movement.movement_type === 'add' ? '#27ae60' : '#e74c3c'};">
                                ${movement.movement_type === 'add' ? '+' : '-'}${movement.quantity}
                            </td>
                            <td><span class="status-badge ${statusClass}">${movementType}</span></td>
                            <td>${movement.employee_name}</td>
                        </tr>
                    `;
                });
                
                movementsHTML += `</tbody></table>`;
                movementsContainer.innerHTML = movementsHTML;
            }
            
            // Ø¹Ø±Ø¶ Ø£ÙØ¶Ù„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
            const productsContainer = document.getElementById('topProducts');
            if (data.top_products.length === 0) {
                productsContainer.innerHTML = '<p style="text-align: center; padding: 30px; color: #999;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…</p>';
            } else {
                let productsHTML = `<div class="top-products-list">`;
                
                data.top_products.forEach((product, index) => {
                    const rankEmoji = index === 0 ? 'ğŸ¥‡' : (index === 1 ? 'ğŸ¥ˆ' : (index === 2 ? 'ğŸ¥‰' : 'ğŸ…'));
                    
                    productsHTML += `
                        <div class="product-item">
                            <div class="product-info">
                                <h4>${rankEmoji} ${product.name}</h4>
                                <p>Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø¨Ø§Ø¹Ø©: ${product.quantity} ÙˆØ­Ø¯Ø©</p>
                            </div>
                            <div class="product-stats">
                                <div class="product-quantity">${product.quantity}</div>
                                <div class="product-sales">${product.sales.toFixed(2)} Ø¬Ù†ÙŠÙ‡</div>
                            </div>
                        </div>
                    `;
                });
                
                productsHTML += `</div>`;
                productsContainer.innerHTML = productsHTML;
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
            updateAlerts(data);
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª
        function updateAlerts(data) {
            const alertsContainer = document.getElementById('alertsContainer');
            let alertsHTML = '';
            
            if (data.low_stock_count > 0) {
                alertsHTML += `
                    <div style="padding: 15px; border-bottom: 1px solid #ffd54f; display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 24px;">âš ï¸</span>
                        <div>
                            <strong style="color: #5d4037;">${data.low_stock_count} Ù…Ù†ØªØ¬</strong> ØªØ­Øª Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ù…Ø®Ø²ÙˆÙ†
                            <div style="margin-top: 5px;">
                                <button class="refresh-btn" style="padding: 5px 10px; font-size: 12px;" 
                                        onclick="location.href='/warehouse'">
                                    Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            if (data.out_of_stock_count > 0) {
                alertsHTML += `
                    <div style="padding: 15px; border-bottom: 1px solid #ffd54f; display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 24px;">âŒ</span>
                        <div>
                            <strong style="color: #5d4037;">${data.out_of_stock_count} Ù…Ù†ØªØ¬</strong> Ù†ÙØ° Ù…Ù† Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
                            <div style="margin-top: 5px;">
                                <button class="refresh-btn" style="padding: 5px 10px; font-size: 12px;" 
                                        onclick="location.href='/purchase_orders'">
                                    Ø¥Ù†Ø´Ø§Ø¡ Ø·Ù„Ø¨ Ø´Ø±Ø§Ø¡
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            if (data.today_sales_count === 0) {
                alertsHTML += `
                    <div style="padding: 15px; border-bottom: 1px solid #ffd54f; display: flex; align-items: center; gap: 10px;">
                        <span style="font-size: 24px;">ğŸ“‰</span>
                        <div>
                            <strong style="color: #5d4037;">Ù„Ù… ØªØªÙ… Ø£ÙŠ Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…!</strong>
                            <div style="margin-top: 5px;">ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒØ§Ø´ÙŠØ± ÙˆØ¹Ø±ÙˆØ¶ Ø§Ù„ØªØ±ÙˆÙŠØ¬</div>
                        </div>
                    </div>
                `;
            }
            
            if (alertsHTML === '') {
                alertsHTML = `
                    <div style="padding: 20px; text-align: center; color: #5d4037;">
                        <div style="font-size: 48px; margin-bottom: 15px;">ğŸ˜´</div>
                        <p style="font-size: 18px; font-weight: bold;">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ†Ø¨ÙŠÙ‡Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</p>
                        <p style="margin-top: 10px; color: #795548;">ÙƒÙ„ Ø´ÙŠØ¡ ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ø·Ø¨ÙŠØ¹ÙŠ</p>
                    </div>
                `;
            }
            
            alertsContainer.innerHTML = alertsHTML;
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
        window.onload = function() {
            loadUserInfo();
            loadDashboardData();
            
            // ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©
            setInterval(loadDashboardData, 30000);
        };
    </script>
</body>
</html>